---
title: "03_construct_figuretable"
author: "Suguru Otani"
date: "2024-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load {.tabset}

```{r, echo=FALSE,results = "asis"}
rm(list = ls())
library(magrittr)
library(ggplot2)
library(modelsummary) # for N in datasummary

utmd_output_hello_work_data <-
  readRDS(file = here::here("output/utmd_output_hello_work_data.rds")) %>% 
  dplyr::rename(
    `unemployed`= candidate_count,
    `vacancies` = position_count,
    `hire` = hire_count,
    `dlog(M)/ dlog(V)` = hire_elasticity_vacancy,
    `dlog(M)/ dlog(U)` = hire_elasticity_unemployed
  )
utmd_output_hello_work_data_yearly <-
  readRDS(file = here::here("output/utmd_output_hello_work_data_yearly.rds")) %>% 
  dplyr::rename(
    `unemployed`= candidate_count,
    `vacancies` = position_count,
    `hire` = hire_count,
    `dlog(M)/ dlog(V)` = hire_elasticity_vacancy,
    `dlog(M)/ dlog(U)` = hire_elasticity_unemployed
  )
```

## Figure 1: Year-level trends in 1966-2023 {.tabset}

the match elasticity with respect to unemployment is in the range 0.5–0.7.

### U, V, and V/U

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::select(
    `unemployed`,
    `vacancies`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
temp2 <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::mutate(
    `V/U` =
      `vacancies`/`unemployed`
  ) %>% 
  dplyr::select(
    `V/U`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count/10000,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  geom_line(
    data = temp2,
    aes(
      x = time, 
      y = count *100
      ), 
    alpha = 0.9, 
    size = 0.5,
    linetype = "dashed"
      ) + 
  scale_y_continuous(
    name = "Count (0.01 million) (solid)",
    sec.axis = sec_axis(
      ~.*0.01, 
      name = "V/U (dashed)"
      )
    ) +
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  labs(colour = "") +
  #ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancy_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```


### H

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
    aes(
      x = time,
      y = `hire`/10000,
      group = 1
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/hire_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```

### Beveridge Curve

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
     aes(
       x = unemployed/10000,
       y = vacancies/10000
       )
     ) +
  geom_line(size = 0.2) +
  geom_point(size = 0.2, alpha = 0.3) +
  geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 1.5) +
  theme_classic() +
  labs(
    # title = "Beveridge Curve",
    x = "U (0.01 mil)",
    y = "V (0.01 mil)"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancies_berveridge_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Job finding rate, worker finding rate

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::mutate(
    `M/U` =
      `hire`/`unemployed`,
    `M/V` =
      `hire`/`vacancies`
  ) %>% 
  dplyr::select(
    `M/U`,
    `M/V`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("") +
  labs(colour = "") +
  #ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/job_finding_rate_worker_finding_rate_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```



### Matching Efficiency A

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
    aes(
      x = time,
      y = efficiency_implied,
      group = 1
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("A (normalized to 2002)") +
  geom_vline(xintercept = "2002", linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/matching_efficiency_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Elasticity dlogM/dlogU,dlogM/dlogV

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::select(
    `dlog(M)/ dlog(V)`,
    `dlog(M)/ dlog(U)`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  #geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("log(M) w.r.t. log(U) and log(V)") +
  labs(colour = "") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/elasticity_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```




### The labor market tightness ($V/U$) and Efficiency ($A$)

```{r,echo=FALSE,results = "asis"}
x <-
  ggplot(
    utmd_output_hello_work_data_yearly,
     aes(
       x = log(vacancies/unemployed),
       y = efficiency_implied
       )
     ) +
  #geom_line(size = 0.5) +
  geom_point() +
  #geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 3) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "log(V/U)",
    y = "A"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/efficiency_tightness_plot_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### The job finding rate ($H/U$) , filling rate ($H/V$) and Efficiency ($A$)

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::mutate(
    `log(M/U)` =
      log(`hire`/`unemployed`),
    `log(M/V)` =
      log(`hire`/`vacancies`)
  ) %>% 
  dplyr::select(
    `log(M/U)`,
    `log(M/V)`,
    efficiency_implied
  ) %>% 
  tidyr::gather(
    type,
    count,
    - efficiency_implied
  )

x <-
  ggplot(
    temp,
    aes(
      x = count,
      y = efficiency_implied,
      color = type, 
      group = type
      )
    ) +
  #geom_line(size = 0.5) +
  geom_point() +
  #geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 3) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "log(M/U), log(M/V)",
    y = "A"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  labs(colour = "") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/job_finding_rate_efficiency_plot_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```




## Figure 2: Month-level trends in 2002-2024 {.tabset}

the match elasticity with respect to unemployment is in the range 0.5–0.7.

### U, V, and V/U

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::select(
    `unemployed`,
    `vacancies`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
temp2 <-
  utmd_output_hello_work_data %>% 
  dplyr::mutate(
    `V/U` =
      `vacancies`/`unemployed`
  ) %>% 
  dplyr::select(
    `V/U`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count/10000,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  geom_line(
    data = temp2,
    aes(
      x = time, 
      y = count *100
      ), 
    alpha = 0.9, 
    size = 0.5,
    linetype = "dashed"
      ) + 
  scale_y_continuous(
    name = "Count (0.01 million) (solid)",
    sec.axis = sec_axis(
      ~.*0.01, 
      name = "V/U (dashed)"
      )
    ) +
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  labs(colour = "") +
  #ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancy_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)


```


### H

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data,
    aes(
      x = time,
      y = `hire`/10000
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/hire_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```

### Beveridge Curve

```{r,echo=FALSE,results = "asis"}
x <-
  ggplot(
    utmd_output_hello_work_data %>% 
      dplyr::mutate(
        time = ifelse(
          month == "01-01",
          year,
          NA
        )
      ),
     aes(
       x = unemployed/10000,
       y = vacancies/10000
       )
     ) +
  geom_line(size = 0.2) +
  geom_point(size = 0.2, alpha = 0.3) +
  geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 2) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "U (0.01 mil)",
    y = "V (0.01 mil)"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancies_berveridge_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Job finding rate and worker finding rate

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::mutate(
    `M/U` =
      `hire`/`unemployed`,
    `M/V` =
      `hire`/`vacancies`
  ) %>% 
  dplyr::select(
    `M/U`,
    `M/V`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  #theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("") +
  labs(colour = "") +
  #ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/job_finding_rate_worker_finding_rate_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```


### Matching Efficiency A

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data,
    aes(
      x = time,
      y = efficiency_implied
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  #theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("A (normalized to 2002 Jan)") +
  #geom_vline(xintercept = 2002, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/matching_efficiency_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Elasticity dlogM/dlogU,dlogM/dlogV

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::select(
    `dlog(M)/ dlog(V)`,
    `dlog(M)/ dlog(U)`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  #geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  xlab("") +
  ylab("log(M) w.r.t. log(U) and log(V)") +
  labs(colour = "") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/elasticity_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
x
```





### The labor market tightness ($V/U$) and Efficiency ($A$)

```{r,echo=FALSE,results = "asis"}
x <-
  ggplot(
    utmd_output_hello_work_data,
     aes(
       x = log(vacancies/unemployed),
       y = efficiency_implied
       )
     ) +
  #geom_line(size = 0.5) +
  geom_point() +
  #geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 3) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "log(V/U)",
    y = "A"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/efficiency_tightness_plot_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### The job finding rate ($H/U$) , filling rate ($H/V$) and Efficiency ($A$)

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::mutate(
    `log(M/U)` =
      log(`hire`/`unemployed`),
    `log(M/V)` =
      log(`hire`/`vacancies`)
  ) %>% 
  dplyr::select(
    `log(M/U)`,
    `log(M/V)`,
    efficiency_implied
  ) %>% 
  tidyr::gather(
    type,
    count,
    - efficiency_implied
  )

x <-
  ggplot(
    temp,
    aes(
      x = count,
      y = efficiency_implied,
      color = type, 
      group = type
      )
    ) +
  #geom_line(size = 0.5) +
  geom_point() +
  #geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 3) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "log(M/U), log(M/V)",
    y = "A"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  labs(colour = "") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/job_finding_rate_efficiency_plot_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```
