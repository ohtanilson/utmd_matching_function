---
title: "03_construct_figuretable"
author: "Suguru Otani"
date: "2024-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load {.tabset}

```{r, echo=FALSE,results = "asis"}
rm(list = ls())
library(magrittr)
library(ggplot2)
library(modelsummary) # for N in datasummary

utmd_output_hello_work_data <-
  readRDS(file = here::here("output/utmd_output_hello_work_data.rds")) %>% 
  dplyr::rename(
    `unemployed`= candidate_count,
    `vacancies` = position_count,
    `hire` = hire_count,
    `d log(M)/ d log(V)` = hire_elasticity_vacancy,
    `d log(M)/ d log(U)` = hire_elasticity_unemployed
  )
utmd_output_hello_work_data_yearly <-
  readRDS(file = here::here("output/utmd_output_hello_work_data_yearly.rds")) %>% 
  dplyr::rename(
    `unemployed`= candidate_count,
    `vacancies` = position_count,
    `hire` = hire_count,
    `d log(M)/ d log(V)` = hire_elasticity_vacancy,
    `d log(M)/ d log(U)` = hire_elasticity_unemployed
  )
```

## Figure 1: Year-level trends in 1966-2023 {.tabset}

the match elasticity with respect to unemployment is in the range 0.5–0.7.

### U and V

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::select(
    `unemployed`,
    `vacancies`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count/10000,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancy_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```


### H

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
    aes(
      x = time,
      y = `hire`/10000,
      group = 1
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/hire_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```

### Beveridge Curve；X=U,Y=V

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
     aes(
       x = unemployed/10000,
       y = vacancies/10000
       )
     ) +
  geom_line(size = 0.5) +
  geom_point() +
  geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 1.5) +
  theme_classic() +
  labs(
    # title = "Beveridge Curve",
    x = "U (0.01 mil)",
    y = "V (0.01 mil)"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancies_berveridge_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Matching Efficiency A

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data_yearly,
    aes(
      x = time,
      y = efficiency_implied,
      color = industry_group_name, 
      group = industry_group_name
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Matching Efficiency (normalized to initial date)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/matching_efficiency_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Elasticity dlogM/dlogU,dlogM/dlogV

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data_yearly %>% 
  dplyr::select(
    `d log(M)/ d log(V)`,
    `d log(M)/ d log(U)`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  #geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Matching elasticity w.r.t. U and V") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/elasticity_year.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```




### The (logarithm of) job finding rate ($H/U$), Efficiency ($A$), and labor market tightness ($V/U$)


## Figure 2: Month-level trends in 2002-2024 {.tabset}

the match elasticity with respect to unemployment is in the range 0.5–0.7.

### U and V

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::select(
    `unemployed`,
    `vacancies`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count/10000,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancy_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)


```


### H

```{r,echo=FALSE,results = "asis"}
x <- 
  ggplot(
    utmd_output_hello_work_data,
    aes(
      x = time,
      y = `hire`/10000
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8)) +
  xlab("") +
  ylab("Count (0.01 million)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/hire_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)

```

### Beveridge Curve；X=U,Y=V

```{r,echo=FALSE,results = "asis"}
x <-
  ggplot(
    utmd_output_hello_work_data,
     aes(
       x = unemployed/10000,
       y = vacancies/10000
       )
     ) +
  geom_line(size = 0.5) +
  geom_point() +
  #geom_text(aes(label = time), hjust = 0.5, vjust = -0.5, size = 3) +
  theme_classic() +
  labs(
    #title = "Beveridge Curve",
    x = "U (0.01 mil)",
    y = "V (0.01 mil)"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0, size = 8)
  ) +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/unemployed_vacancies_berveridge_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Matching Efficiency A

```{r,echo=FALSE,results = "asis"}

x <- 
  ggplot(
    utmd_output_hello_work_data,
    aes(
      x = time,
      y = efficiency_implied
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  theme(axis.text.x = element_text(angle=60, vjust=1, hjust=1, size=3.0)) +
  xlab("") +
  ylab("Matching Efficiency (normalized to initial date)") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/matching_efficiency_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
```

### Elasticity dlogM/dlogU,dlogM/dlogV

```{r,echo=FALSE,results = "asis"}
temp <-
  utmd_output_hello_work_data %>% 
  dplyr::select(
    `d log(M)/ d log(V)`,
    `d log(M)/ d log(U)`,
    time
  ) %>% 
  tidyr::gather(
    type,
    count,
    - time
  )
x <- 
  ggplot(
    temp,
    aes(
      x = time,
      y = count,
      color = type, 
      group = type
      )
    ) +
  geom_line(
    alpha = 0.9, 
    size = 0.5
    ) + 
  # geom_point(
  #   aes(
  #     shape = industry_group_name,
  #     color = industry_group_name
  #     )
  #   ) +
  #geom_hline(yintercept = 100, linetype = "longdash") +
  theme_classic() + 
  #scale_color_viridis_d() +
  theme(legend.position = 'top',
        legend.text = element_text(size=8))+
  xlab("") +
  ylab("Matching elasticity w.r.t. U and V") +
  # geom_vline(xintercept = 1980, linetype = "longdash") +
  # geom_vline(xintercept = 1984, linetype = "longdash") +
  scale_color_viridis_d()
x
figure_name <-
  "../figuretable/elasticity_month.png"
ggsave(filename = figure_name,
       plot = x,
       device = "png",
       width = 4,
       height = 3)
x
```





### The (logarithm of) job finding rate ($H/U$), Efficiency ($A$), and labor market tightness ($V/U$)
